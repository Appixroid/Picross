<!DOCTYPE html>

<html> 
	<head>
		<title>â–¦ Picross</title>
		<meta charset="UTF-8" />
		
		<!-- Google Icons -->
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
		
		<!-- Drawers -->
		<link rel="stylesheet" href="https://cdn.louis-parent.fr/drawers/style/?f=sizing+layout+bordering+coloring+utils+spacing+cursor+text"/>
		<script src="https://cdn.louis-parent.fr/drawers/script/?f="></script>
		
		<link rel="stylesheet" href="style.css"/>
		<link rel="stylesheet" href="picross.css"/>
		<script src="./Picross.js"></script>
		
		<script>
			var randomPicross = null;
			var triggers = {};
			
			window.addEventListener("load", () => {
				setupTriggers();
				triggerElement(document.getElementById("default-trigger"));
				
				generateRandomPicross();
				document.getElementById("random-grid").addEventListener("change", event => {
					let rows = getRowsOfGrid(event.target);
					if(randomPicross.areRowsValid(rows))
					{
						alert("You Win !");
					}
				});
			});
			
			function setupTriggers()
			{
				document.querySelectorAll("[trigger]").forEach(element => {
					let targetId = element.getAttribute("trigger");
					let target = document.getElementById(targetId);
					
					triggers[targetId] = target;
					target.style.display = "none";
					
					element.addEventListener("click", (event) => {
						let element = event.target;
						while(!element.hasAttribute("trigger"))
						{
							element = element.parentNode;
						}
						
						triggerElement(element);
					});
				});
			}
			
			function triggerElement(source)
			{
				for(let triggerId in triggers)
				{
					triggers[triggerId].style.display = "none";
				}

				triggers[source.getAttribute("trigger")].style.display = "flex";
			}
			
			function generateRandomPicross()
			{
				let width = parseInt(document.getElementById("random-grid-width").value);
				let height = parseInt(document.getElementById("random-grid-height").value);
				randomPicross = Picross.generate(width, height);
				randomPicross.attach(document.getElementById("random-grid"), true);
			}
			
			function getRowsOfGrid(gridElement)
			{
				let rows = [];
				
				for(let row of gridElement.children)
				{					
					if(row != gridElement.firstChild)
					{
						let currentRow = [];
						
						for(let cell of row.children)
						{
							if(cell != row.firstChild)
							{
								currentRow.push(cell.classList.contains("active"));
							}
						}
						
						rows.push(currentRow);
					}
				}
				
				return rows;
			}
		</script>
	</head>
	
	<body class="full-viewport unscrollable row-layout">
		<aside class="quarter-width full-height">
			<h1 class="row-layout center-aligned-layout no-y-margin">
				<span class="material-icons" style="margin-right: 0.25em;">grid_on</span>
				Picross
			</h1>
			
			<nav>
				<ul>
					<li id="default-trigger" class="row-layout center-aligned-layout pointer-cursor" trigger="random">
						<span class="material-icons">casino</span>
						<span>Random Grid</span>
					</li>
					
					<li class="row-layout center-aligned-layout pointer-cursor" trigger="load">
						<span class="material-icons">input</span>
						<span>Load Grid</span>
					</li>
					
					<li class="row-layout center-aligned-layout pointer-cursor" trigger="draw">
						<span class="material-icons">brush</span>
						<span>Draw Grid</span>
					</li>
				</ul>
			</nav>
		</aside>
		
		<main class="three-quarter-width full-height">
			<div id="random" class="column-layout center-aligned-layout">
				<div class="row-layout around-justified-layout center-aligned-layout full-width spaced">
					<div class="column-layout">
						<div>
							<input id="random-grid-width" type="number" value="5" min="1" step="1" style="max-width: 5em;" /> x <input id="random-grid-height" type="number" value="5" min="1" step="1" style="max-width: 5em;" /> Cells
						</div>
						
						<button class="row-layout center-aligned-layout center-justified-layout pointer-cursor centered-text" onclick="generateRandomPicross()">
							<span class="material-icons">casino</span>
							Generate
						</button>
					</div>
					
					<button class="row-layout center-aligned-layout center-justified-layout pointer-cursor centered-text" style="max-height: 3em;" onclick="randomPicross.clearDisplay()">
						<span class="material-icons">clear</span>
						Clear
					</button>	
				</div>
				
				<div id="random-grid" class="grid">
				
				</div>
			</div>
			
			<div id="load">
				Load Work in Progress
			</div>
			
			<div id="draw">
				Draw Work in Progress
			</div>
		</main>
	</body>
</html>
